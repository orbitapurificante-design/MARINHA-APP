<!DOCTYPE html>
<html><head><meta charset="UTF-8"><title>Debug MARINHA</title>
<style>body{font-family:monospace;background:#111;color:#0f0;padding:20px;font-size:13px;}
.ok{color:#0f0;}.err{color:#f44;}.warn{color:#fa0;}
button{padding:10px 20px;margin:5px;background:#222;color:#0f0;border:1px solid #0f0;cursor:pointer;font-size:14px;}
pre{background:#000;padding:12px;border-radius:6px;overflow:auto;max-height:300px;white-space:pre-wrap;word-break:break-all;}
</style></head>
<body>
<h2>üîç Debug MARINHA localStorage</h2>
<button onclick="verificar()">‚ñ∂ Verificar agora</button>
<button onclick="limpar()">üóë Limpar tudo</button>
<button onclick="window.location='index.html'">‚Üí App Cliente</button>
<button onclick="window.location='admin.html'">‚Üí Admin</button>
<div id="out"></div>
<script>
function verificar() {
  var out = document.getElementById('out');
  var html = '';
  
  // Verificar MARINHA_V2
  var s = localStorage.getItem('MARINHA_V2');
  if (!s) {
    html += '<p class="err">‚ùå MARINHA_V2 = VAZIO (admin nunca guardou ou falhou)</p>';
  } else {
    try {
      var d = JSON.parse(s);
      html += '<p class="ok">‚úÖ MARINHA_V2 existe (' + s.length + ' chars)</p>';
      html += '<p class="ok">   Clientes: ' + (d.clientes||[]).length + '</p>';
      html += '<p class="ok">   Promos: ' + (d.promos||[]).length + '</p>';
      html += '<p class="ok">   Folhetos: ' + (d.folhetos||[]).length + '</p>';
      html += '<p class="ok">   Config nomeLoja: ' + (d.config&&d.config.nomeLoja||'(vazio)') + '</p>';
      html += '<p class="ok">   ClienteLogado: ' + (d.clienteLogado||'nenhum') + '</p>';
      if (d.promos && d.promos.length) {
        html += '<p class="warn">Promos:</p><pre>' + JSON.stringify(d.promos, null, 2) + '</pre>';
      }
      if (d.clientes && d.clientes.length) {
        html += '<p class="warn">Clientes:</p><pre>' + JSON.stringify(d.clientes.map(function(c){return{id:c.id,nome:c.nome,pts:c.pts};}), null, 2) + '</pre>';
      }
    } catch(e) {
      html += '<p class="err">‚ùå MARINHA_V2 corrompido: ' + e.message + '</p>';
    }
  }

  // Verificar MARINHA_CLI
  var sc = localStorage.getItem('MARINHA_CLI');
  if (!sc) {
    html += '<p class="warn">‚ö†Ô∏è MARINHA_CLI = VAZIO</p>';
  } else {
    try {
      var dc = JSON.parse(sc);
      html += '<p class="ok">‚úÖ MARINHA_CLI existe (' + sc.length + ' chars)</p>';
      html += '<p class="ok">   Logado: ' + (dc.logado||'nenhum') + '</p>';
      html += '<p class="ok">   Clientes: ' + (dc.clientes||[]).length + '</p>';
    } catch(e) {
      html += '<p class="err">‚ùå MARINHA_CLI corrompido</p>';
    }
  }

  // Verificar quota
  try {
    var teste = 'x'.repeat(1024*1024); // 1MB
    localStorage.setItem('_quota_test', teste);
    localStorage.removeItem('_quota_test');
    html += '<p class="ok">‚úÖ localStorage tem espa√ßo (>1MB dispon√≠vel)</p>';
  } catch(e) {
    html += '<p class="err">‚ùå localStorage CHEIO: ' + e.message + '</p>';
  }

  // Verificar IndexedDB
  var r = indexedDB.open('MARINHA_V2', 1);
  r.onsuccess = function(e) {
    var db = e.target.result;
    var tx = db.transaction('imgs', 'readonly');
    var req = tx.objectStore('imgs').getAllKeys();
    req.onsuccess = function() {
      html += '<p class="ok">‚úÖ IndexedDB: ' + req.result.length + ' imagens (' + req.result.join(', ') + ')</p>';
      out.innerHTML = html;
    };
  };
  r.onerror = function() {
    html += '<p class="err">‚ùå IndexedDB falhou</p>';
    out.innerHTML = html;
  };
  r.onupgradeneeded = function(e) { e.target.result.createObjectStore('imgs'); };

  out.innerHTML = html + '<p class="warn">A verificar IndexedDB...</p>';
}

function limpar() {
  if (!confirm('Apagar TUDO? Clientes, promos, folhetos - tudo!')) return;
  localStorage.removeItem('MARINHA_V2');
  localStorage.removeItem('MARINHA_CLI');
  localStorage.removeItem('MARINHA_PIN');
  var r = indexedDB.deleteDatabase('MARINHA_V2');
  r.onsuccess = function() { alert('Tudo limpo!'); verificar(); };
}

verificar();
</script>
</body></html>
